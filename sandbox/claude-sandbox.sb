(version 1)
(deny default)
(import "system.sb")

;; Project directory â€” full read/write
(allow file-read* file-write* (subpath (param "PROJECT_DIR")))

;; Temp directories
(allow file-read* file-write* (subpath (param "TMPDIR")))
(allow file-read* file-write* (subpath "/private/tmp"))

;; Device files (shell/process infrastructure)
(allow file-read* file-write* (subpath "/dev"))

;; System libraries and binaries (read-only)
(allow file-read* (subpath "/usr"))
(allow file-read* (subpath "/bin"))
(allow file-read* (subpath "/sbin"))
(allow file-read* (subpath "/Library"))
(allow file-read* (subpath "/System"))
(allow file-read* (subpath "/opt/homebrew"))  ; Homebrew on ARM
(allow file-read* (subpath "/usr/local"))     ; Homebrew on Intel
(allow file-read* (subpath "/private/var"))   ; system state (resolv.conf, etc.)

;; Home directory read access (node/npm/claude-code installations)
(allow file-read* (subpath (param "HOME")))
;; npm/node writes to ~/.npm, ~/.config, etc.
(allow file-write* (subpath (param "HOME_NPM")))
(allow file-write* (subpath (param "HOME_CONFIG")))

;; Process execution
(allow process-exec*)  ; sandbox-exec children inherit the sandbox

;; Network (Claude API calls)
(allow network-outbound)
(allow network* (local ip "localhost:*"))

;; Process management
(allow process-fork)
(allow signal)
(allow sysctl-read)
